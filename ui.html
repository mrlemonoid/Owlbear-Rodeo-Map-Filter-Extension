<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Map Filter</title>
  <style>
    body { font-family: sans-serif; padding: 10px; }
    label { display: block; margin: 0.5em 0; }
  </style>
</head>
<body>
  <label>Hue <input type="range" id="hue" min="-180" max="180" value="0"></label>
  <label>Saturation <input type="range" id="saturation" min="0" max="2" step="0.1" value="1"></label>
  <label>Brightness <input type="range" id="brightness" min="0" max="2" step="0.1" value="1"></label>
  <label>Gamma <input type="range" id="gamma" min="0.1" max="3" step="0.1" value="1"></label>
  <label>Chroma Key <input type="color" id="colorKey" value="#00ff00"></label>
  <script src="script.js" type="module"></script>
</body>
</html>

// script.js
import OBR from "https://unpkg.com/@owlbear-rodeo/sdk@1.4.3"

const filters = {
  hue: 0,
  saturation: 1,
  brightness: 1,
  gamma: 1,
  colorKey: "#00ff00"
};

function getFilterString() {
  return `hue-rotate(${filters.hue}deg) saturate(${filters.saturation}) brightness(${filters.brightness})`;
}

function updateMapFilters() {
  OBR.scene.items.getItems().then(items => {
    for (const item of items) {
      if (item.type === "IMAGE" && item.layer === "MAP") {
        OBR.scene.items.updateItems([{
          id: item.id,
          metadata: {
            "map-filter": {
              filter: getFilterString()
            }
          }
        }]);
      }
    }
  });
}

["hue", "saturation", "brightness", "gamma"].forEach(id => {
  document.getElementById(id).addEventListener("input", e => {
    filters[id] = parseFloat(e.target.value);
    updateMapFilters();
  });
});

document.getElementById("colorKey").addEventListener("input", e => {
  filters.colorKey = e.target.value;
  // Chroma key logika később kerül beépítésre
});

OBR.onReady(() => {
  console.log("Map Filter extension ready.");
  updateMapFilters();
});